mapping:
  event_id:        ["event_id", "evt_id"]
  country_name:    ["country_name", "country"]
  iso3:            ["iso3", "iso_code3"]
  hazard_code:     ["hazard_code", "hz_code"]
  hazard_label:    ["hazard_label", "hz_label"]
  hazard_class:    ["hazard_class", "hz_class"]
  metric:          ["metric", "measure"]
  value:           ["value", "count", "people"]
  unit:            ["unit"]
  as_of_date:      ["as_of_date", "as_of"]
  publication_date: ["publication_date", "published"]
  publisher:       ["publisher", "org"]
  source_type:     ["source_type", "source"]
  source_url:      ["source_url", "url"]
  doc_title:       ["doc_title", "title"]
  definition_text: ["definition_text", "definition", "note"]
  method:          ["method", "ingest_method"]
  confidence:      ["confidence"]
  revision:        ["revision", "rev"]
  artifact_id:     ["artifact_id"]
  artifact_sha256: ["artifact_sha256"]
  notes:           ["notes"]
  alt_value:       ["alt_value"]
  alt_source_url:  ["alt_source_url"]
  proxy_for:       ["proxy_for"]
  precedence_decision: ["precedence_decision"]
  ingested_at:     ["ingested_at"]

constants:
  unit: "persons"
  method: "api"
  confidence: "med"
  revision: 1

transforms:
  metric:
    in_need:    ["pin", "people_in_need", "in need", "in-need"]
    affected:   ["pa", "people_affected", "affected"]
    displaced:  ["idps", "displaced", "internal_displacement"]
    cases:      ["cases", "confirmed_cases", "suspected_cases"]

dates:
  as_of_date: ["date_as_of", "asof"]
  publication_date: ["pub_date", "pub"]

sources:
  - name: dtm_displacement_admin0
    match:
      filename_regex: "(?i)dtm.*displacement.*\\.csv$"
      required_columns: [CountryISO3, ReportingDate, idp_count]
    map:
      iso3:
        from: CountryISO3
        ops: [trim, uppercase]
      as_of_date:
        from: ReportingDate
        ops: [to_date]
      ym:
        from: as_of_date
        ops: [to_ym]
      metric:
        const: idps
      value:
        from: idp_count
        ops: [to_number]
      semantics:
        const: stock
      source:
        const: IOM DTM
    filters:
      - keep_if_not_null: [CountryISO3, ReportingDate, idp_count]
      - keep_if_positive: [value]
    dedupe:
      keys: [iso3, as_of_date, metric]
      keep: last
