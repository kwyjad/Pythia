# Pythia
# Copyright (c) 2025 Kevin Wyjad
# Licensed under the Pythia Non-Commercial Public License v1.0.
# See the LICENSE file in the project root for details.

---
name: Resolver â€” Simple Snapshot (Manual)

on:
  workflow_dispatch:
    inputs:
      ym:
        description: "Target year-month (YYYY-MM). If omitted, use tool default."
        required: false
      db_path:
        description: "Path to DuckDB database"
        required: false
        default: "data/resolver_backfill.duckdb"

jobs:
  simple-snapshot:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install resolver (editable)
        run: |
          python -m pip install --upgrade pip
          pip install -e .

      - name: Run simple snapshot extract
        run: |
          set -euo pipefail
          YM="${{ github.event.inputs.ym }}"
          DB_PATH="${{ github.event.inputs.db_path }}"
          if [ -z "$YM" ]; then
            echo "[simple_snapshot] ym not provided; tool will pick default."
            python -m resolver.cli.simple_snapshot --db "$DB_PATH"
          else
            python -m resolver.cli.simple_snapshot --db "$DB_PATH" --ym "$YM"
          fi

      - name: Upload snapshot artifact
        uses: actions/upload-artifact@v4
        with:
          name: simple-snapshot
          path: snapshots/simple
          if-no-files-found: warn
