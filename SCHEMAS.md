<!--- DO NOT EDIT: generated by resolver/tools/generate_schemas_md.py on 2026-01-04Z -->

# Resolver Schemas

## Table of contents

- [staging.common](#stagingcommon)
- [staging.reliefweb_pdf](#stagingreliefwebpdf)
- [staging.unhcr_odp](#stagingunhcrodp)
- [staging.worldpop](#stagingworldpop)
- [db.facts_raw](#dbfactsraw)
- [db.facts_resolved](#dbfactsresolved)
- [db.facts_deltas](#dbfactsdeltas)
- [db.emdat_pa](#dbemdatpa)
- [db.acled_monthly_fatalities](#dbacledmonthlyfatalities)
- [db.snapshots](#dbsnapshots)
- [db.manifests](#dbmanifests)
- [db.llm_calls](#dbllmcalls)
- [context.facts_last12](#contextfactslast12)

## staging.common

Canonical staging columns for event-centric connectors.

| Name | Type | Required | Enum/Format | Description |
| --- | --- | --- | --- | --- |
| event_id | string | yes |  |  |
| country_name | string | yes |  |  |
| iso3 | string | yes |  |  |
| hazard_code | string | yes |  |  |
| hazard_label | string | yes |  |  |
| hazard_class | string | yes |  |  |
| metric | enum | yes | in_need, affected, displaced, cases, fatalities<br>events, participants |  |
| series_semantics | enum | no | stock, new |  |
| value | number | yes |  |  |
| unit | enum | yes | persons, persons_cases, events |  |
| as_of_date | string | yes |  | ISO-8601 date (YYYY-MM-DD) |
| publication_date | string | yes |  | ISO-8601 date (YYYY-MM-DD) |
| publisher | string | yes |  |  |
| source_type | string | yes |  |  |
| source_url | string | yes |  |  |
| doc_title | string | yes |  |  |
| definition_text | string | yes |  |  |
| method | string | yes |  |  |
| confidence | string | yes |  |  |
| revision | integer | yes |  |  |
| ingested_at | date | yes |  |  |
| value_new | number | no |  |  |
| value_stock | number | no |  |  |
| rebase_flag | integer | no |  |  |
| first_observation | integer | no |  |  |
| delta_negative_clamped | integer | no |  |  |

## staging.reliefweb_pdf

ReliefWeb PDF staging output with attachment metadata.

| Name | Type | Required | Enum/Format | Description |
| --- | --- | --- | --- | --- |
| extraction_layer | string | no |  |  |
| matched_phrase | string | no |  |  |
| method_details | string | no |  |  |
| method_value | string | no |  |  |
| month_start | string | no |  |  |
| resource_url | string | no |  |  |
| tier | string | no |  |  |
| value_level | number | no |  |  |

## staging.unhcr_odp

UNHCR Operational Data Portal staging output.

| Name | Type | Required | Enum/Format | Description |
| --- | --- | --- | --- | --- |
| source | string | yes |  |  |
| source_event_id | string | yes |  |  |
| as_of_date | date | yes |  |  |
| country_iso3 | string | yes |  |  |
| country_name | string | yes |  |  |
| hazard_code | string | yes |  |  |
| hazard_label | string | yes |  |  |
| hazard_class | string | yes |  |  |
| metric_name | string | yes |  |  |
| metric_unit | string | yes |  |  |
| series_semantics | enum | no | stock, new |  |
| value | number | yes |  |  |
| evidence_url | string | yes |  |  |
| evidence_label | string | yes |  |  |

## staging.worldpop

WorldPop denominators staging output.

| Name | Type | Required | Enum/Format | Description |
| --- | --- | --- | --- | --- |
| iso3 | string | yes |  |  |
| year | integer | yes |  |  |
| population | number | yes |  |  |
| source | string | yes |  |  |
| product | string | yes |  |  |
| download_date | date | yes |  |  |
| source_url | string | yes |  |  |
| notes | string | no |  |  |

## db.facts_raw

Canonical facts written to DuckDB alongside CSV exports.

| Name | Type | Required | Enum/Format | Description |
| --- | --- | --- | --- | --- |
| event_id | string | yes |  |  |
| country_name | string | yes |  |  |
| iso3 | string | yes |  |  |
| hazard_code | string | yes |  |  |
| hazard_label | string | yes |  |  |
| hazard_class | string | yes |  |  |
| metric | enum | yes | in_need, affected, displaced, cases, fatalities<br>events, participants |  |
| series_semantics | enum | no | stock, new |  |
| value | number | yes |  |  |
| unit | enum | yes | persons, persons_cases, events |  |
| as_of_date | string | yes |  | ISO-8601 date (YYYY-MM-DD) |
| publication_date | string | yes |  | ISO-8601 date (YYYY-MM-DD) |
| publisher | string | yes |  |  |
| source_type | string | yes |  |  |
| source_url | string | no |  |  |
| doc_title | string | yes |  |  |
| definition_text | string | yes |  |  |
| method | string | yes |  |  |
| confidence | string | yes |  |  |
| revision | integer | yes |  |  |
| ingested_at | date | yes |  |  |
| value_new | number | no |  |  |
| value_stock | number | no |  |  |
| rebase_flag | integer | no |  |  |
| first_observation | integer | no |  |  |
| delta_negative_clamped | integer | no |  |  |
| created_at | datetime | no |  |  |

## db.facts_resolved

Resolved precedence outputs stored in DuckDB for querying.

| Name | Type | Required | Enum/Format | Description |
| --- | --- | --- | --- | --- |
| ym | string | yes |  |  |
| iso3 | string | yes |  |  |
| hazard_code | string | yes |  |  |
| hazard_label | string | yes |  |  |
| hazard_class | string | yes |  |  |
| metric | enum | yes | in_need, affected, displaced, cases, fatalities<br>events, participants |  |
| series_semantics | enum | no | stock, new |  |
| value | number | yes |  |  |
| unit | enum | yes | persons, persons_cases, events |  |
| as_of_date | string | yes |  | ISO-8601 date (YYYY-MM-DD) |
| publication_date | string | yes |  | ISO-8601 date (YYYY-MM-DD) |
| publisher | string | yes |  |  |
| source_type | string | no |  |  |
| source_url | string | no |  |  |
| doc_title | string | no |  |  |
| definition_text | string | no |  |  |
| precedence_tier | string | no |  |  |
| event_id | string | no |  |  |
| proxy_for | string | no |  |  |
| confidence | string | no |  |  |
| created_at | datetime | no |  |  |

## db.facts_deltas

Monthly "new" deltas derived from resolved totals.

| Name | Type | Required | Enum/Format | Description |
| --- | --- | --- | --- | --- |
| ym | string | yes |  |  |
| iso3 | string | yes |  |  |
| hazard_code | string | yes |  |  |
| metric | enum | yes | in_need, affected, displaced, cases, fatalities<br>events, participants |  |
| value_new | number | yes |  |  |
| value_stock | number | no |  |  |
| series_semantics | enum | no | new |  |
| rebase_flag | integer | no |  |  |
| first_observation | integer | no |  |  |
| delta_negative_clamped | integer | no |  |  |
| as_of | string | yes |  | ISO-8601 date (YYYY-MM-DD) |
| source_name | string | yes |  |  |
| source_url | string | no |  |  |
| definition_text | string | no |  |  |
| created_at | datetime | no |  |  |

## db.emdat_pa

EM-DAT People Affected monthly aggregates written by the EM-DAT CLI.

**Keys:** `iso3`, `ym`, `shock_type`

| Name | Type | Required | Enum/Format | Description |
| --- | --- | --- | --- | --- |
| iso3 | string | yes |  | ISO 3166-1 alpha-3 country code. |
| ym | string | yes |  | Resolver month key in YYYY-MM format. |
| shock_type | string | yes |  | Resolver shock type (\`drought\`, \`tropical_cyclone\`, \`flood\`). |
| pa | integer | yes |  | People affected (EM-DAT Total Affected) aggregated to the month. |
| as_of_date | string | yes |  | Data currency date sourced from EM-DAT metadata. |
| publication_date | string | yes |  | Latest EM-DAT publication/update contributing to the bucket. |
| source_id | string | yes |  | Source identifier (\`emdat\`). |
| disno_first | string | yes |  | Lowest EM-DAT disaster identifier contributing to the month bucket. |

## db.acled_monthly_fatalities

Monthly ACLED fatalities aggregated by ISO3.

**Keys:** `iso3`, `month`

| Name | Type | Required | Enum/Format | Description |
| --- | --- | --- | --- | --- |
| iso3 | string | yes |  | ISO 3166-1 alpha-3 country code. |
| month | date | yes |  | Month bucket in YYYY-MM-01 format. |
| fatalities | integer | yes |  | Total fatalities reported by ACLED for the month window. |
| source | string | yes |  | Constant \`ACLED\` source tag. |
| updated_at | timestamp | yes |  | UTC timestamp when the aggregation was generated. |

## db.snapshots

Snapshot metadata recorded alongside dual-write operations.

| Name | Type | Required | Enum/Format | Description |
| --- | --- | --- | --- | --- |
| ym | string | yes |  |  |
| created_at | datetime | yes |  |  |
| git_sha | string | no |  |  |
| export_version | string | no |  |  |
| facts_rows | integer | no |  |  |
| deltas_rows | integer | no |  |  |
| meta | string | no |  |  |

## db.manifests

Snapshot manifest entries mirroring CSV exports.

| Name | Type | Required | Enum/Format | Description |
| --- | --- | --- | --- | --- |
| ym | string | yes |  |  |
| name | string | yes |  |  |
| path | string | no |  |  |
| rows | integer | no |  |  |
| checksum | string | no |  |  |
| payload | string | no |  |  |
| created_at | datetime | no |  |  |

## db.llm_calls

LLM call telemetry and diagnostics across HS, research, and forecasting.

| Name | Type | Required | Enum/Format | Description |
| --- | --- | --- | --- | --- |
| call_id | string | yes |  |  |
| run_id | string | no |  |  |
| hs_run_id | string | no |  |  |
| question_id | string | no |  |  |
| call_type | string | no |  |  |
| phase | string | no |  |  |
| model_name | string | no |  |  |
| provider | string | no |  |  |
| model_id | string | no |  |  |
| prompt_text | string | no |  |  |
| response_text | string | no |  |  |
| parsed_json | string | no |  |  |
| usage_json | string | no |  |  |
| elapsed_ms | integer | no |  |  |
| prompt_tokens | integer | no |  |  |
| completion_tokens | integer | no |  |  |
| total_tokens | integer | no |  |  |
| cost_usd | number | no |  |  |
| error_text | string | no |  |  |
| status | enum | no | ok, error |  |
| error_type | enum | no | timeout, rate_limit, parse_error, provider_disabled, provider_error<br>unknown |  |
| error_message | string | no |  |  |
| response_format | enum | no | fenced_json, json, text, empty |  |
| hazard_scores_json | string | no |  |  |
| hazard_scores_parse_ok | boolean | no |  |  |
| timestamp | datetime | no |  |  |
| iso3 | string | no |  |  |
| hazard_code | string | no |  |  |
| metric | string | no | in_need, affected, displaced, cases, fatalities<br>events, participants |  |

## context.facts_last12

LLM context bundle summarising monthly new-series PIN/PA totals.

| Name | Type | Required | Enum/Format | Description |
| --- | --- | --- | --- | --- |
| iso3 | string | yes |  |  |
| hazard_code | string | yes |  |  |
| ym | string | yes |  | Year-month bucket (YYYY-MM) |
| metric | enum | yes | in_need, affected |  |
| unit | enum | yes | persons |  |
| value | number | yes |  |  |
| series | enum | yes | new |  |
